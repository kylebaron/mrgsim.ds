<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Apache Arrow Dataset-Backed Simulation Outputs for mrgsolve • mrgsim.ds</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Apache Arrow Dataset-Backed Simulation Outputs for mrgsolve">
<meta name="description" content="Provides tools for creating and managing file streams in support of large simulation or other outputs.">
<meta property="og:description" content="Provides tools for creating and managing file streams in support of large simulation or other outputs.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">mrgsim.ds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/mrgsim.ds.html">Get Started</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kylebaron/mrgim.ds/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="mrgsimds">mrgsim.ds<a class="anchor" aria-label="anchor" href="#mrgsimds"></a>
</h1></div>
<!-- badges: start -->

<p><code>mrgsim.ds</code> provides an <a href="https://arrow.apache.org/docs/r/" class="external-link">Apache Arrow</a>-backed simulation output object for <a href="https://mrgsolve.org" class="external-link">mrgsolve</a>, greatly reducing the memory footprint of large simulations and providing a high-performance pipeline for summarizing huge simulation outputs. The arrow-based simulation output objects in R claim ownership of their files on disk. Those files are automatically removed when the owning object goes out of scope and becomes subject to the R garbage collector. While “anonymous”, parquet-formatted files hold the data in <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> as you are working in R, functions are provided to move this data to more permanent locations for later use.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>mrgsim.ds</code> from <a href="https://kylebaron.r-universe.dev/mrgsim.ds" class="external-link">r-universe</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install 'mrgsim.ds' in R:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'mrgsim.ds'</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'https://kylebaron.r-universe.dev'</span>, <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We will illustrate <code>mrgsim.ds</code> by doing a simulation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kylebaron/mrgsim.ds" class="external-link">mrgsim.ds</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mread_ds.html">modlib_ds</a></span><span class="op">(</span><span class="st">"popex"</span>, end <span class="op">=</span> <span class="fl">240</span>, outvars <span class="op">=</span> <span class="st">"IPRED,CL"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mrgsolve.org/docs/reference/expand.idata.html" class="external-link">expand.ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">24</span>, total <span class="op">=</span> <span class="fl">6</span>, ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3000</span><span class="op">)</span></span></code></pre></div>
<p><code>mrgsim.ds</code> provides a new <code><a href="https://mrgsolve.org/docs/reference/mrgsim.html" class="external-link">mrgsim()</a></code> variant - <code><a href="reference/mrgsim_ds.html">mrgsim_ds()</a></code>. The name implies we are tapping into Apache Arrow <a href="https://arrow.apache.org/docs/r/reference/Dataset.html" class="external-link">Dataset</a> functionality. The simulation below carries <code>1,446,000</code> rows.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">mrgsim_ds</span>(mod, data)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>out</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>. Model<span class="sc">:</span> popex</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>. Dim  <span class="sc">:</span> <span class="fl">1.4</span>M x <span class="dv">4</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>. Files<span class="sc">:</span> <span class="dv">1</span> [<span class="fl">11.9</span> Mb]</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>. Owner<span class="sc">:</span> yes</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>.     ID time       CL     IPRED</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>. <span class="dv">1</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">0.0</span> <span class="fl">1.111243</span> <span class="fl">0.0000000</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>. <span class="dv">2</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">0.0</span> <span class="fl">1.111243</span> <span class="fl">0.0000000</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>. <span class="dv">3</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">0.5</span> <span class="fl">1.111243</span> <span class="fl">0.2888122</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>. <span class="dv">4</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">1.0</span> <span class="fl">1.111243</span> <span class="fl">0.5474283</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>. <span class="dv">5</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">1.5</span> <span class="fl">1.111243</span> <span class="fl">0.7785421</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>. <span class="dv">6</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">2.0</span> <span class="fl">1.111243</span> <span class="fl">0.9846138</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>. <span class="dv">7</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">2.5</span> <span class="fl">1.111243</span> <span class="fl">1.1678907</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>. <span class="dv">8</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">3.0</span> <span class="fl">1.111243</span> <span class="fl">1.3304253</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="very-lightweight-simulation-output-object">Very lightweight simulation output object<a class="anchor" aria-label="anchor" href="#very-lightweight-simulation-output-object"></a>
</h2>
<p>The output object doesn’t actually carry these 1.4M rows of simulated data. Rather it stores a pointer to the data in parquet files on your disk.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">basename</span>(out<span class="sc">$</span>files)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="st">"mrgsims-ds-dd772b49d749.parquet"</span></span></code></pre></div>
<p>This means there is almost nothing inside the object itself</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>lobstr<span class="sc">:::</span><span class="fu">obj_size</span>(out)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>. <span class="fl">292.51</span> kB</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">dim</span>(out)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="dv">1446000</span>       <span class="dv">4</span></span></code></pre></div>
<p>What if we did the same simulation with regular <code><a href="https://mrgsolve.org/docs/reference/mrgsim.html" class="external-link">mrgsim()</a></code>?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">mrgsim</span>(mod, data)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">obj_size</span>(x)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>. <span class="fl">46.30</span> MB</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">dim</span>(x)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="dv">1446000</span>       <span class="dv">4</span></span></code></pre></div>
<p>The <code>mrgsim.ds</code> object is very light weight despite tracking the same data.</p>
</div>
<div class="section level2">
<h2 id="handles-like-regular-mrgsim-output">Handles like regular mrgsim output<a class="anchor" aria-label="anchor" href="#handles-like-regular-mrgsim-output"></a>
</h2>
<p>But, we can do a lot of the typical things we would with any <code><a href="https://mrgsolve.org/docs/reference/mrgsim.html" class="external-link">mrgsim()</a></code> output object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span>, nid <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_head_tail_dim-1.png" alt="" width="80%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">head</span>(out)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>. <span class="co"># A tibble: 6 × 4</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>.      ID  time    CL IPRED</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>.   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>. <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">0</span>    <span class="fl">1.11</span> <span class="dv">0</span>    </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>. <span class="dv">2</span>     <span class="dv">1</span>   <span class="dv">0</span>    <span class="fl">1.11</span> <span class="dv">0</span>    </span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>. <span class="dv">3</span>     <span class="dv">1</span>   <span class="fl">0.5</span>  <span class="fl">1.11</span> <span class="fl">0.289</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>. <span class="dv">4</span>     <span class="dv">1</span>   <span class="dv">1</span>    <span class="fl">1.11</span> <span class="fl">0.547</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>. <span class="dv">5</span>     <span class="dv">1</span>   <span class="fl">1.5</span>  <span class="fl">1.11</span> <span class="fl">0.779</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>. <span class="dv">6</span>     <span class="dv">1</span>   <span class="dv">2</span>    <span class="fl">1.11</span> <span class="fl">0.985</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="fu">tail</span>(out)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>. <span class="co"># A tibble: 6 × 4</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>.      ID  time    CL     IPRED</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>.   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>. <span class="dv">1</span>  <span class="dv">3000</span>  <span class="fl">238.</span>  <span class="fl">1.79</span> <span class="fl">0.0000165</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>. <span class="dv">2</span>  <span class="dv">3000</span>  <span class="dv">238</span>   <span class="fl">1.79</span> <span class="fl">0.0000156</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>. <span class="dv">3</span>  <span class="dv">3000</span>  <span class="fl">238.</span>  <span class="fl">1.79</span> <span class="fl">0.0000148</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>. <span class="dv">4</span>  <span class="dv">3000</span>  <span class="dv">239</span>   <span class="fl">1.79</span> <span class="fl">0.0000140</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>. <span class="dv">5</span>  <span class="dv">3000</span>  <span class="fl">240.</span>  <span class="fl">1.79</span> <span class="fl">0.0000132</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>. <span class="dv">6</span>  <span class="dv">3000</span>  <span class="dv">240</span>   <span class="fl">1.79</span> <span class="fl">0.0000125</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="fu">dim</span>(out)</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="dv">1446000</span>       <span class="dv">4</span></span></code></pre></div>
<p>This includes coercing to different types of objects. We can get the usual R data frames</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">as_tibble</span>(out)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>. <span class="co"># A tibble: 1,446,000 × 4</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>.       ID  time    CL IPRED</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>.    <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>.  <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">0</span>    <span class="fl">1.11</span> <span class="dv">0</span>    </span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>.  <span class="dv">2</span>     <span class="dv">1</span>   <span class="dv">0</span>    <span class="fl">1.11</span> <span class="dv">0</span>    </span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>.  <span class="dv">3</span>     <span class="dv">1</span>   <span class="fl">0.5</span>  <span class="fl">1.11</span> <span class="fl">0.289</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>.  <span class="dv">4</span>     <span class="dv">1</span>   <span class="dv">1</span>    <span class="fl">1.11</span> <span class="fl">0.547</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>.  <span class="dv">5</span>     <span class="dv">1</span>   <span class="fl">1.5</span>  <span class="fl">1.11</span> <span class="fl">0.779</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>.  <span class="dv">6</span>     <span class="dv">1</span>   <span class="dv">2</span>    <span class="fl">1.11</span> <span class="fl">0.985</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>.  <span class="dv">7</span>     <span class="dv">1</span>   <span class="fl">2.5</span>  <span class="fl">1.11</span> <span class="fl">1.17</span> </span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>.  <span class="dv">8</span>     <span class="dv">1</span>   <span class="dv">3</span>    <span class="fl">1.11</span> <span class="fl">1.33</span> </span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>.  <span class="dv">9</span>     <span class="dv">1</span>   <span class="fl">3.5</span>  <span class="fl">1.11</span> <span class="fl">1.47</span> </span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>. <span class="dv">10</span>     <span class="dv">1</span>   <span class="dv">4</span>    <span class="fl">1.11</span> <span class="fl">1.60</span> </span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>. <span class="co"># ℹ 1,445,990 more rows</span></span></code></pre></div>
<p>Or stay in the arrow ecosystem</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">as_arrow_ds</span>(out)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>. FileSystemDataset with <span class="dv">1</span> Parquet file</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>. <span class="dv">4</span> columns</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>. ID<span class="sc">:</span> double</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>. time<span class="sc">:</span> double</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>. CL<span class="sc">:</span> double</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>. IPRED<span class="sc">:</span> double</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>. </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>. See <span class="sc">$</span>metadata <span class="cf">for</span> additional Schema metadata</span></code></pre></div>
<p>Or try your hand at duckdb</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">as_duckdb_ds</span>(out)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>. <span class="co"># Source:   table&lt;arrow_001&gt; [?? x 4]</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>. <span class="co"># Database: DuckDB 1.4.3 [kyleb@Darwin 24.6.0:R 4.5.2/:memory:]</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>.       ID  time    CL IPRED</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>.    <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>.  <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">0</span>    <span class="fl">1.11</span> <span class="dv">0</span>    </span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>.  <span class="dv">2</span>     <span class="dv">1</span>   <span class="dv">0</span>    <span class="fl">1.11</span> <span class="dv">0</span>    </span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>.  <span class="dv">3</span>     <span class="dv">1</span>   <span class="fl">0.5</span>  <span class="fl">1.11</span> <span class="fl">0.289</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>.  <span class="dv">4</span>     <span class="dv">1</span>   <span class="dv">1</span>    <span class="fl">1.11</span> <span class="fl">0.547</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>.  <span class="dv">5</span>     <span class="dv">1</span>   <span class="fl">1.5</span>  <span class="fl">1.11</span> <span class="fl">0.779</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>.  <span class="dv">6</span>     <span class="dv">1</span>   <span class="dv">2</span>    <span class="fl">1.11</span> <span class="fl">0.985</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>.  <span class="dv">7</span>     <span class="dv">1</span>   <span class="fl">2.5</span>  <span class="fl">1.11</span> <span class="fl">1.17</span> </span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>.  <span class="dv">8</span>     <span class="dv">1</span>   <span class="dv">3</span>    <span class="fl">1.11</span> <span class="fl">1.33</span> </span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>.  <span class="dv">9</span>     <span class="dv">1</span>   <span class="fl">3.5</span>  <span class="fl">1.11</span> <span class="fl">1.47</span> </span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>. <span class="dv">10</span>     <span class="dv">1</span>   <span class="dv">4</span>    <span class="fl">1.11</span> <span class="fl">1.60</span> </span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>. <span class="co"># ℹ more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tidyverse-friendly">Tidyverse-friendly<a class="anchor" aria-label="anchor" href="#tidyverse-friendly"></a>
</h2>
<p>We’ve integrated into the <code>dplyr</code> ecosystem as well, allowing you to <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>, or <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> your way directly into a pipeline to summarize your simulations using the power of Apache Arrow.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>dd <span class="ot">&lt;-</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  out <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(IPRED, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="fu">arrange</span>(time)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>dd</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>. <span class="fu">FileSystemDataset</span> (query)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>. time<span class="sc">:</span> double</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>. Mean<span class="sc">:</span> double</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>. n<span class="sc">:</span> int64</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>. </span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>. <span class="sc">*</span> Sorted by time [asc]</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>. See <span class="sc">$</span>.data <span class="cf">for</span> the source Arrow object</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">collect</span>(dd)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>. <span class="co"># A tibble: 481 × 3</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>.     time  Mean     n</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>.    <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>.  <span class="dv">1</span>   <span class="dv">0</span>    <span class="dv">0</span>     <span class="dv">6000</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>.  <span class="dv">2</span>   <span class="fl">0.5</span>  <span class="fl">1.11</span>  <span class="dv">3000</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>.  <span class="dv">3</span>   <span class="dv">1</span>    <span class="fl">1.82</span>  <span class="dv">3000</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>.  <span class="dv">4</span>   <span class="fl">1.5</span>  <span class="fl">2.28</span>  <span class="dv">3000</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>.  <span class="dv">5</span>   <span class="dv">2</span>    <span class="fl">2.60</span>  <span class="dv">3000</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>.  <span class="dv">6</span>   <span class="fl">2.5</span>  <span class="fl">2.81</span>  <span class="dv">3000</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>.  <span class="dv">7</span>   <span class="dv">3</span>    <span class="fl">2.96</span>  <span class="dv">3000</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>.  <span class="dv">8</span>   <span class="fl">3.5</span>  <span class="fl">3.06</span>  <span class="dv">3000</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>.  <span class="dv">9</span>   <span class="dv">4</span>    <span class="fl">3.12</span>  <span class="dv">3000</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>. <span class="dv">10</span>   <span class="fl">4.5</span>  <span class="fl">3.15</span>  <span class="dv">3000</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>. <span class="co"># ℹ 471 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="good-for-large-simulations">Good for large simulations<a class="anchor" aria-label="anchor" href="#good-for-large-simulations"></a>
</h2>
<p>This workflow is particularly useful when running replicate simulations in parallel, with large outputs</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">library</span>(future.apply, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">5</span><span class="dt">L</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">future_lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, \(x) { <span class="fu">mrgsim_ds</span>(mod, data) }, <span class="at">future.seed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">reduce_ds</span>(out2)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>out2</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>. Model<span class="sc">:</span> popex</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>. Dim  <span class="sc">:</span> <span class="fl">14.5</span>M x <span class="dv">4</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>. Files<span class="sc">:</span> <span class="dv">10</span> [<span class="fl">119.1</span> Mb]</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>. Owner<span class="sc">:</span> yes</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>.     ID time       CL    IPRED</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>. <span class="dv">1</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">0.0</span> <span class="fl">2.234653</span> <span class="fl">0.000000</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>. <span class="dv">2</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">0.0</span> <span class="fl">2.234653</span> <span class="fl">0.000000</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>. <span class="dv">3</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">0.5</span> <span class="fl">2.234653</span> <span class="fl">1.362086</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>. <span class="dv">4</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">1.0</span> <span class="fl">2.234653</span> <span class="fl">2.174659</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>. <span class="dv">5</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">1.5</span> <span class="fl">2.234653</span> <span class="fl">2.638650</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>. <span class="dv">6</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">2.0</span> <span class="fl">2.234653</span> <span class="fl">2.882302</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>. <span class="dv">7</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">2.5</span> <span class="fl">2.234653</span> <span class="fl">2.987434</span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>. <span class="dv">8</span><span class="sc">:</span>   <span class="dv">1</span>  <span class="fl">3.0</span> <span class="fl">2.234653</span> <span class="fl">3.006216</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="files-on-disk-are-automagically-managed">Files on disk are automagically managed<a class="anchor" aria-label="anchor" href="#files-on-disk-are-automagically-managed"></a>
</h2>
<p>All <code>arrow</code> files are stored in the <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> in parquet format</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">list_temp</span>()</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>. <span class="dv">11</span> files [<span class="fl">131.1</span> Mb]</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>dd772b49d749.parquet</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb46f333a95.parquet</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>.    ...</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb819ed1fa5.parquet</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb81eb896ef.parquet</span></code></pre></div>
<p>This directory is eventually removed when the R session ends. Tools are provided to manage the space.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">retain_temp</span>(out2)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>. Discarding <span class="dv">1</span> files.</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">list_temp</span>()</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>. <span class="dv">10</span> files [<span class="fl">119.1</span> Mb]</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb46f333a95.parquet</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb4c4b453c.parquet</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>.    ...</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb819ed1fa5.parquet</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>ddb81eb896ef.parquet</span></code></pre></div>
<p>We also put a finalizer on each object so that, when it goes out of scope, the files are automatically cleaned up.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">purge_temp</span>()</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>. Discarding <span class="dv">10</span> files.</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">5</span><span class="dt">L</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">mrgsim_ds</span>(mod, data)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="fu">rename_ds</span>(out1, <span class="st">"out1"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">future_lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, \(x) { <span class="fu">mrgsim_ds</span>(mod, data) }, <span class="at">future.seed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">reduce_ds</span>(out2)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="fu">rename_ds</span>(out2, <span class="st">"out2"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">mrgsim_ds</span>(mod, data) </span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="fu">rename_ds</span>(out3, <span class="st">"out3"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">list_temp</span>()</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>. <span class="dv">12</span> files [<span class="dv">143</span> Mb]</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>out1<span class="fl">-0001.</span>parquet</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>out2<span class="fl">-0001.</span>parquet</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>.    ...</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>out2<span class="fl">-0010.</span>parquet</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>out3<span class="fl">-0001.</span>parquet</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="fu">rm</span>(out2)</span></code></pre></div>
<p>As soon as the garbage collector is called, the leftover files are cleaned up.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>.            <span class="fu">used</span>  (Mb) gc <span class="fu">trigger</span>  (Mb) <span class="fu">limit</span> (Mb) max <span class="fu">used</span>  (Mb)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>. Ncells  <span class="dv">1952423</span> <span class="fl">104.3</span>    <span class="dv">3644254</span> <span class="fl">194.7</span>         <span class="cn">NA</span>  <span class="dv">3169376</span> <span class="fl">169.3</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>. Vcells <span class="dv">15247170</span> <span class="fl">116.4</span>   <span class="dv">29097431</span> <span class="fl">222.0</span>      <span class="dv">16384</span> <span class="dv">26998858</span> <span class="fl">206.0</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="fu">list_temp</span>()</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>. <span class="dv">2</span> files [<span class="fl">23.8</span> Mb]</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>out1<span class="fl">-0001.</span>parquet</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>. <span class="sc">-</span> mrgsims<span class="sc">-</span>ds<span class="sc">-</span>out3<span class="fl">-0001.</span>parquet</span></code></pre></div>
<div class="section level3">
<h3 id="ownership">Ownership<a class="anchor" aria-label="anchor" href="#ownership"></a>
</h3>
<p>This setup is only possible if one object owns the files on disk and <code>mrgsim.ds</code> tracks this.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">ownership</span>()</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>. <span class="sc">&gt;</span> Objects<span class="sc">:</span> <span class="dv">4</span> <span class="sc">|</span> Files<span class="sc">:</span> <span class="dv">13</span> <span class="sc">|</span> Size<span class="sc">:</span> <span class="fl">23.8</span> Mb</span></code></pre></div>
<p>If I make a copy of a simulation object, the old object no longer owns the files.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>out4 <span class="ot">&lt;-</span> <span class="fu">copy_ds</span>(out1, <span class="at">own =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">check_ownership</span>(out1)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="fu">check_ownership</span>(out4)</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="cn">TRUE</span></span></code></pre></div>
<p>I can always take ownership back.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">take_ownership</span>(out1)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="fu">check_ownership</span>(out1)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="fu">check_ownership</span>(out4)</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="cn">FALSE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="if-this-is-so-great-why-not-make-it-the-default-for-mrgsolve">If this is so great, why not make it the default for mrgsolve?<a class="anchor" aria-label="anchor" href="#if-this-is-so-great-why-not-make-it-the-default-for-mrgsolve"></a>
</h2>
<p>There is a cost to all of this. For small to mid-size simulations, you might see a small slowdown with <code><a href="reference/mrgsim_ds.html">mrgsim_ds()</a></code>; it definitely won’t be faster than <code><a href="https://mrgsolve.org/docs/reference/mrgsim.html" class="external-link">mrgsim()</a></code> … even with the super-quick arrow ecosystem. This workflow is really for large simulation volumes where you are happy to pay the cost of writing outputs to file and then streaming them back in to summarize.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/kylebaron/mrgim.ds/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/kylebaron/mrgim.ds/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=2)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing mrgsim.ds</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kyle T Baron <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0001-7252-5656" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://kylebaron.r-universe.dev/mrgsim.ds" class="external-link"><img src="https://kylebaron.r-universe.dev/mrgsim.ds/badges/version" alt="R-universe version"></a></li>
<li><a href="https://kylebaron.r-universe.dev/mrgsim.ds" class="external-link"><img src="https://kylebaron.r-universe.dev/mrgsim.ds/badges/checks" alt="r-universe status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle T Baron.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
